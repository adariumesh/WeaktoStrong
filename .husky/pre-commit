#!/bin/bash
# Pre-commit hook for Weak-to-Strong platform

echo "üîç Running pre-commit checks..."

# Run lint-staged for frontend files
npx lint-staged

# Check Python formatting if backend files changed
if git diff --cached --name-only | grep -q "backend/.*\.py$"; then
    echo "üêç Checking Python code..."
    
    # Check if virtual environment exists
    if [ -f "backend/venv/bin/activate" ]; then
        source backend/venv/bin/activate
    fi
    
    # Format check with Black
    if ! (cd backend && black --check .); then
        echo "‚ùå Python code is not formatted correctly"
        echo "Run: cd backend && black ."
        exit 1
    fi
    
    # Lint with Ruff
    if ! (cd backend && ruff check .); then
        echo "‚ùå Python linting failed"
        echo "Fix the issues above or run: cd backend && ruff check . --fix"
        exit 1
    fi
    
    echo "‚úÖ Python checks passed"
fi

echo "‚úÖ Pre-commit checks passed!"
